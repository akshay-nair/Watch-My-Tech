<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta content="stuff, to, help, search, engines, not" name="keywords">
		<meta content="What this page is about." name="description">
		<meta content="Display Webcam Stream" name="title">
		<title>Display Webcam Stream</title>
		  
		<style>
			#container {
				margin: 0px auto;
				width: 500px;
				height: 375px;
			}
			#videoElement {
				width: 500px;
				height: 375px;
				background-color: #666;
			}
			#output {
				display:none;
			}
		</style>
		
		<script src="https://cdn.socket.io/socket.io-1.4.3.js"></script>
	</head>
	  
	<body>

		<div id="container">
			<center>
				<button id="startSession" onclick="startSession();">New Session</button>
				<br/>
				<input type="text" id="sessionIDField"/><button id="joinSession" onclick="joinSession();">Join Session</button>
				<div id="sessionField"/>
			</center>
			<img id="webstream" width="500px" height="375px"/>
			<center>
				<button id="sayvoice" style="display:none;" onclick="sendVoice();">ACTIVATE VOICE</button>
			</center>
		</div>

		<script>
			var socket = io();
			var img = document.getElementById("webstream");
			var session_id = "";
			
			socket.on('watch_error', function(msg) {
				alert(msg);
			});
			
			socket.on('image', function(data) {
				img.src = data;
			});
			
			socket.on('startSessionSuccess', function(sessionID) {
				session_id = sessionID;
				document.getElementById("sessionField").innerHTML = "Session ID: " + sessionID; 
				document.getElementById("startSession").style.display = "none";
				document.getElementById("sessionIDField").style.display = "none";
				document.getElementById("joinSession").style.display = "none";
				document.getElementById("sayvoice").style.display = "block";
			});
			
			socket.on('joinSessionSuccess', function() {
				var sessionID = document.getElementById("sessionIDField").value;
				session_id = sessionID;
				document.getElementById("sessionField").innerHTML = "Session ID: " + sessionID; 
				document.getElementById("startSession").style.display = "none";
				document.getElementById("sessionIDField").style.display = "none";
				document.getElementById("joinSession").style.display = "none";
				document.getElementById("sayvoice").style.display = "block";
			});
			
			function startSession() {
				socket.emit("startSession");
			}
			
			function joinSession() {
				var sessionID = document.getElementById("sessionIDField").value;
				socket.emit("joinSession", sessionID);
			}
			
			function sendVoice() {
				socket.emit("sendVoice", session_id);
			}
		</script>
	</body>
</html>